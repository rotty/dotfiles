#!/bin/sh

# This little script runs the typical installation sequence for auto*
# projects, installing them user-locally using stow

project_name="`basename $PWD`"

getroot=""
stow_args="--user"
location="user-locally"
prefix_arg="--prefix=$HOME/.system/stow/$project_name"

case "$1" in
    --system)
	shift
	stow_args=""
	location="system-wide"
	prefix_arg="--prefix=/usr/local/stow/$project_name"
	getroot="sudo"
	break
	;;
    *)
	break
	;;
esac

echo -n "Install $project_name $location? [y/n] "
read answer
if [ "$answer" = y ]; then
    if [ -x configure ]; then
	set -e
	if ! [ -f Makefile ]; then
	    ./configure "$prefix_arg" "$@"
	fi 
	make && $getroot make install
    elif [ -x autogen.sh ]; then
	./autogen.sh "$prefix_arg" "$@" \
	    && make && $getroot make install
    elif [ -f setup.py ]; then
	python setup.py build && $getroot python setup.py install "$prefix_arg"
    else
	echo "no installable project found here, aborting."
	exit 1
    fi
    do-stow $stow_args "$project_name"
fi
